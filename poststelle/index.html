<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ü¶Ö FSA Werkstatt-Zentrale ¬∑ TOKEN-CONTROL</title>
<style>
  :root {
    --bg:#0b1220;--card:#111827;--text:#e2e8f0;
    --ok:#10b981;--warn:#f59e0b;--err:#ef4444;
    --btn:#2563eb;--btn-hover:#1e40af;
  }
  body{
    font-family:system-ui,Segoe UI,Roboto,sans-serif;
    background:var(--bg);color:var(--text);
    margin:0;padding:40px;text-align:center;
  }
  h1{font-size:1.8rem;margin-bottom:20px;color:#38bdf8;}
  input[type=password]{
    padding:8px 12px;border-radius:6px;border:1px solid #1e293b;
    background:#111827;color:#fff;font-size:1rem;width:240px;
  }
  button{
    background:var(--btn);color:#fff;border:none;
    padding:8px 14px;border-radius:6px;font-weight:600;
    cursor:pointer;margin-left:8px;
  }
  button:hover{background:var(--btn-hover);}
  table{width:100%;max-width:900px;margin:30px auto;border-collapse:collapse;}
  th,td{padding:12px;border-bottom:1px solid #1e293b;}
  th{background:#1e293b;text-align:left;}
  tr:hover{background:#1e293b33;}
  .status{font-weight:600;}
  .ok{color:var(--ok);}
  .err{color:var(--err);}
  footer{margin-top:30px;font-size:.85rem;color:#64748b;}
</style>
</head>

<body>
<h1>ü¶Ö FSA Werkstatt-Zentrale</h1>
<p>Token-gesteuerte System√ºbersicht ¬∑ aktiviert & pr√ºft alle Module</p>

<!-- TOKEN-EINGABE -->
<div id="token-area">
  <input type="password" id="tokenInput" placeholder="Token eingeben...">
  <button onclick="activateSystem()">System aktivieren</button>
</div>

<!-- STATUS-TABELLE -->
<table id="statusTable" style="display:none;">
  <tr><th>Modul</th><th>Status</th><th>Zuletzt gepr√ºft</th><th>Aktion</th></tr>

  <tr data-url="https://adler-fsa.github.io/Lp-Generator/tools/werkstatt-installer_v2.4.9_TOKEN_SAFE.html">
    <td>üèóÔ∏è Werkstatt-Installer</td><td class="status">‚è≥</td><td class="time">‚Äì</td>
    <td><a class="btn" target="_blank" href="#">√ñffnen</a></td>
  </tr>

  <tr data-url="https://adler-fsa.github.io/Lp-Generator/poststelle/">
    <td>üì¨ Poststelle</td><td class="status">‚è≥</td><td class="time">‚Äì</td>
    <td><a class="btn" target="_blank" href="#">√ñffnen</a></td>
  </tr>

  <tr data-url="https://adler-fsa.github.io/Lp-Generator/">
    <td>‚öôÔ∏è LP-Generator</td><td class="status">‚è≥</td><td class="time">‚Äì</td>
    <td><a class="btn" target="_blank" href="#">√ñffnen</a></td>
  </tr>

  <tr data-url="https://adler-fsa.github.io/Lp-Generator/tools/js/patch-manager_backup.js">
    <td>üß† Patch-Manager</td><td class="status">‚è≥</td><td class="time">‚Äì</td>
    <td><a class="btn" target="_blank" href="#">Code</a></td>
  </tr>

  <tr data-url="https://github.com/Adler-FSA/Lp-Generator/commits/main">
    <td>üßæ Werkstatt-Logs</td><td class="status">‚è≥</td><td class="time">‚Äì</td>
    <td><a class="btn" target="_blank" href="#">√ñffnen</a></td>
  </tr>

  <tr data-url="https://github.com/Adler-FSA/Lp-Generator/blob/main/tools/Adler-FSA_Werkstatt_v2.4.5b_FULL_SAFE_ADLER_GLOW.zip">
    <td>üóÇÔ∏è Backup-Archiv</td><td class="status">‚è≥</td><td class="time">‚Äì</td>
    <td><a class="btn" target="_blank" href="#">Download</a></td>
  </tr>
</table>

<footer>FSA Werkstatt-System | Admin-Board v1.1 TOKEN-CONTROL</footer>

<script>
let globalToken="";

function activateSystem(){
  const token=document.getElementById("tokenInput").value.trim();
  if(!token){alert("Bitte g√ºltigen Token eingeben.");return;}
  globalToken=token;
  document.getElementById("token-area").style.display="none";
  document.getElementById("statusTable").style.display="table";
  refreshAll();
  setInterval(refreshAll,60000);
}

async function checkStatus(row){
  const url=row.dataset.url;
  const statusCell=row.querySelector(".status");
  const timeCell=row.querySelector(".time");
  const btn=row.querySelector(".btn");
  try{
    const fullUrl=url+(url.includes("?")?"&":"?")+"token="+encodeURIComponent(globalToken);
    const res=await fetch(fullUrl,{method:"HEAD",mode:"no-cors"});
    statusCell.textContent="üü¢ aktiv";
    statusCell.className="status ok";
    btn.href=fullUrl;
  }catch(e){
    statusCell.textContent="üî¥ offline";
    statusCell.className="status err";
  }
  timeCell.textContent=new Date().toLocaleTimeString("de-DE");
}

function refreshAll(){
  document.querySelectorAll("#statusTable tr[data-url]").forEach(r=>checkStatus(r));
}
</script>
<!-- ===========================
  FSA Mega-Deploy v1 ‚Äì Auto-Uploader f√ºr Poststelle
  =========================== -->
<script>
(async () => {
  const repo = "Adler-FSA/Lp-Generator";
  const token = prompt("Bitte GitHub-Token (ghp_...) eingeben:");
  if (!token) { alert("Kein Token eingegeben. Abbruch."); return; }

  const api = (path) => `https://api.github.com/repos/${repo}/contents/${path}`;
  const headers = {
    "Authorization": `token ${token}`,
    "Content-Type": "application/json",
    "Accept": "application/vnd.github+json"
  };
  const enc = (s) => btoa(unescape(encodeURIComponent(s)));

  async function getSha(path){
    const r = await fetch(api(path), { headers });
    if (r.status === 200) { const j = await r.json(); return j.sha; }
    return null;
  }
  async function putFile(path, content, message){
    const sha = await getSha(path);
    const body = { message, content: enc(content) };
    if (sha) body.sha = sha;
    const r = await fetch(api(path), { method: "PUT", headers, body: JSON.stringify(body) });
    if (!r.ok) throw new Error(`Upload-Fehler ${path}: ${r.status}`);
  }

  function log(msg){ console.log(msg); statusEl.textContent += `\n${msg}`; }

  const statusEl = document.createElement("pre");
  statusEl.style.cssText = "background:#0b1220;color:#e5e7eb;padding:16px;border:1px solid #1e293b;border-radius:8px;white-space:pre-wrap;max-width:900px;margin:16px auto;font-family:ui-monospace,Menlo,Consolas,monospace;";
  statusEl.textContent = "ü¶Ö FSA Mega-Deploy gestartet‚Ä¶";
  document.body.appendChild(statusEl);

  try {
    const POSTSTELLE = `<html><body>‚úÖ Poststelle wurde aktualisiert (TOKEN-SAFE)</body></html>`;
    const TOOLS = `<html><body>‚úÖ Tools √úbersicht v1.0</body></html>`;
    const PATCH = `<html><body>‚úÖ Patch Manager Wrapper erstellt</body></html>`;
    const INSTALLER = `<html><body>‚úÖ Installer v2.4.9 TOKEN-SAFE</body></html>`;
    const AUTO = `// Redirect-Handler`;
    const ROOT = `<html><body>‚úÖ Root redirect eingerichtet</body></html>`;

    await putFile("poststelle/index.html", POSTSTELLE, "Poststelle v2.4.9 TOKEN-SAFE redirect");
    await putFile("tools/index.html", TOOLS, "Tools overview index");
    await putFile("tools/js/patch-manager.html", PATCH, "Add Patch-Manager HTML wrapper");
    await putFile("tools/werkstatt-installer_v2.4.9_TOKEN_SAFE.html", INSTALLER, "Installer v2.4.9 TOKEN-SAFE");
    await putFile("auto-init/auto-redirect.js", AUTO, "Add/Update auto-redirect handler");
    await putFile("tools.html", ROOT, "Root redirect to tools/index.html");

    log("‚úÖ Alle Dateien erfolgreich √ºbertragen.");
    alert("‚úÖ FSA Mega-Deploy abgeschlossen!");
  } catch(e){
    console.error(e);
    statusEl.textContent += `\n‚ùå Fehler: ${e.message}`;
    alert("‚ùå Fehler beim Mega-Deploy:\n" + e.message);
  }
})();
</script>
<!-- =========================== --></body>
</html>
