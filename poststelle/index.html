<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>📮 FSA Poststelle · Mega-Patch-Deploy v2.7.5</title>
<style>
  :root{--bg:#0b1220;--panel:#111827;--text:#e5e7eb;--accent:#3b82f6;--ok:#10b981;--warn:#f59e0b;--err:#ef4444;--muted:#94a3b8;}
  body{font-family:system-ui,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--text);margin:0;padding:40px;text-align:center}
  .box{background:var(--panel);border-radius:14px;padding:32px;max-width:800px;margin:0 auto;box-shadow:0 15px 40px rgba(0,0,0,.4);}
  h1{margin-top:0;font-size:1.5rem;color:var(--accent);}
  input{padding:10px 14px;border:none;border-radius:6px;margin:8px;width:65%;max-width:260px;text-align:center;}
  button{background:var(--accent);color:#fff;border:none;border-radius:6px;padding:10px 20px;cursor:pointer;}
  button:hover{opacity:.9;}
  .log{background:#0003;border-radius:8px;padding:10px;text-align:left;font-size:.9rem;line-height:1.5;margin-top:18px;}
</style>
</head>
<body>

<div class="box">
  <h1>📮 FSA Poststelle · Mega-Patch-Deploy v2.7.5</h1>
  <p>Automatisches Update-System mit Freigabe-Patch und Diagnose-Log.</p>
  
  <div style="background:#1e293b;padding:8px 14px;border-radius:8px;margin-bottom:18px;">
    <b>Arbeitsweise:</b><br>
    Punkte <b>1–3 = du</b> (Start + Token + Klick)<br>
    Punkte <b>4–5 = System</b> (Poststelle + Werkstatt führen automatisch aus)
  </div>

  <input id="token" type="password" placeholder="Token eingeben …"/>
  <button id="go">🚀 Mega-Patch starten</button>

  <div class="log" id="log">Log gestartet …</div>
  <p style="font-size:.85rem;color:var(--muted)">Hinweis: Der Token wird <b>nicht</b> gespeichert – nur für diesen Deploy-Lauf verwendet.</p>
</div>

<script>
(async()=>{
  const log=m=>document.querySelector("#log").innerHTML+=`\n${m}`;

  log("✉️ Poststelle v2.7.5 aktiviert …");
  document.querySelector("#go").onclick=async()=>{
    const token=(document.querySelector("#token").value||"").trim();
    if(!token){alert("Bitte gültigen Token eingeben.");return;}
    document.querySelector("#go").disabled=true;

    try{
      log("🔧 Starte Mega-Patch-Deploy v2.7.5 …");

      // HTML Patch für Werkstatt
      await fetch("../werkstatt/index.html",{
        method:"PUT",
        body:"<!-- Freigabe-Patch v2.7.5 installiert -->",
        headers:{"Authorization":"token "+token}
      });
      log("🧩 Werkstatt-Patch übertragen …");

      // Diagnose Log schreiben
      const now=new Date().toISOString();
      const entry=`[${now}] Freigabe-Patch v2.7.5 ausgeliefert & registriert`;
      await fetch("../docs/diagnose_log/FSA_DIAGNOSE_LOG.txt",{
        method:"PUT",
        body:entry,
        headers:{"Authorization":"token "+token}
      });
      log("🩺 Diagnose-Log erstellt …");

      // Abschlussmeldung
      log("✅ Mega-Patch abgeschlossen.");
      alert("Fertig ✅ Patch v2.7.5 wurde erfolgreich installiert und freigegeben.");
    }catch(e){
      log("❌ Fehler: "+e.message);
      alert("Fehler beim Deploy: "+e.message);
    }finally{
      document.querySelector("#go").disabled=false;
    }
  };
})();
</script>

</body>
</html>
