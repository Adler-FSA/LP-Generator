<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ðŸ“® FSA Poststelle v2.7.3 Â· Autonom-Update-System</title>
<style>
  :root{--bg:#0b1220;--card:#111827;--ink:#e5e7eb;--muted:#94a3b8;--accent:#38bdf8;--ok:#10b981;--warn:#fbbf24;--err:#ef4444;}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:960px;margin:40px auto;padding:0 16px}
  h1{font-size:1.8rem;margin:0 0 10px;color:var(--accent)}
  p.lead{margin:0 0 20px;color:var(--muted)}
  .info{background:#0f172a;border:1px solid #1e293b;border-radius:10px;padding:14px;margin:16px 0}
  .info b{color:#e2e8f0}
  .card{background:var(--card);border:1px solid #1e293b;border-radius:12px;padding:20px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  input[type=password]{background:#0f172a;border:1px solid #1e293b;border-radius:8px;color:#fff;padding:10px 12px;font-size:1rem;min-width:260px}
  button{cursor:pointer;border:0;border-radius:8px;font-weight:700}
  .primary{background:#2563eb;color:#fff;padding:10px 14px}
  .ghost{background:#1f2937;color:#cbd5e1;padding:8px 12px}
  .hint{font-size:.9rem;color:#8da0be;margin-top:8px}
  pre#log{white-space:pre-wrap;background:#0f172a;border:1px dashed #334155;border-radius:8px;padding:12px;min-height:140px;max-height:400px;overflow:auto;margin-top:16px}
  .footer{margin-top:18px;color:#64748b;font-size:.85rem;text-align:center}
  .badge{display:inline-block;padding:3px 8px;border-radius:6px;font-size:.8rem;margin-left:8px}
  .ok{background:rgba(16,185,129,.2);color:#10b981}
  .warn{background:rgba(251,191,36,.2);color:#fbbf24}
  .err{background:rgba(239,68,68,.2);color:#ef4444}
</style>
</head>
<body>
<div class="wrap">
  <h1>ðŸ“® FSA Poststelle Â· Mega-Patch-Deploy <small style="font-weight:600;color:#7dd3fc">v2.7.3</small></h1>
  <p class="lead">Autonomes Update-System mit automatischer SelbstprÃ¼fung & Werkstatt-Integration.</p>

  <div class="info">
    <b>Arbeitsweise:</b><br>
    Punkte <b>1â€“3 = du</b> (Start + Token + Klick) Â· Punkte <b>4â€“5 = System</b> (Poststelle + Werkstatt fÃ¼hren automatisch aus).<br><br>
    <b>Status:</b> <span id="verStatus" class="badge warn">ÃœberprÃ¼fe Version â€¦</span>
  </div>

  <div class="card">
    <div class="row">
      <input id="token" type="password" placeholder="Token eingeben â€¦" />
      <button id="go" class="primary">ðŸš€ Mega-Patch starten</button>
      <button id="btnLoad" class="ghost" title="aus URL Ã¼bernehmen">ðŸ”„</button>
    </div>
    <div class="hint">Hinweis: Der Token wird <b>nicht gespeichert</b> â€“ nur fÃ¼r diesen Deploy-Lauf verwendet.</div>
    <pre id="log">Log gestartet â€¦</pre>
  </div>

  <div class="footer">FSA Poststelle Â· autonomer Deploy-Runner Â· Build v2.7.3</div>
</div>

<script>
const OWNER="Adler-FSA",REPO="Lp-Generator",BRANCH="main";
const apiBase=`https://api.github.com/repos/${OWNER}/${REPO}/contents`;
const $=s=>document.querySelector(s);
const enc=s=>btoa(unescape(encodeURIComponent(s)));
const log=(m,cls="")=>{const el=$("#log");el.innerHTML+=m+"\\n";el.scrollTop=el.scrollHeight;};

// Version Self-Check
(async()=>{
 try{
  const res=await fetch(`https://raw.githubusercontent.com/${OWNER}/${REPO}/${BRANCH}/poststelle/index.html`);
  const txt=await res.text();
  const m=txt.match(/v(\\d+\\.\\d+\\.\\d+)/);
  const remoteVer=m?m[1]:"unknown";
  const localVer="2.7.3";
  const el=$("#verStatus");
  if(remoteVer===localVer){el.textContent="Aktuell ("+localVer+")";el.className="badge ok";}
  else{el.textContent="Update verfÃ¼gbar ("+remoteVer+")";el.className="badge warn";}
 }catch(e){$("#verStatus").textContent="Fehler bei VersionsprÃ¼fung";$("#verStatus").className="badge err";}
})();

// GitHub PUT
async function getSha(path,token){
 const url=`${apiBase}/${path}?ref=${BRANCH}`;
 const res=await fetch(url,{headers:{"Accept":"application/vnd.github+json","Authorization":"token "+token}});
 if(res.status===200){const j=await res.json();return j.sha;}
 if(res.status===404)return null;
 throw new Error("GET "+path+" -> "+res.status);
}
async function putFile(path,content,message,token){
 const sha=await getSha(path,token).catch(()=>null);
 const body={message,content:enc(content),branch:BRANCH};
 if(sha)body.sha=sha;
 const res=await fetch(`${apiBase}/${path}`,{
  method:"PUT",
  headers:{"Accept":"application/vnd.github+json","Authorization":"token "+token},
  body:JSON.stringify(body)
 });
 if(!res.ok){const t=await res.text();throw new Error(`PUT ${path} -> ${res.status} ${t}`);}
}

// Deploy-Routine
$("#go").onclick=async()=>{
 const token=($("#token").value||new URLSearchParams(location.search).get("token")||"").trim();
 if(!token)return alert("Bitte gÃ¼ltigen Token eingeben.");
 $("#go").disabled=true;$("#token").disabled=true;
 log("ðŸŸ¦ Starte Mega-Patch-Deploy â€¦");

 try{
  await putFile("tools/patch-manager.html","<html><body>ðŸ§  Patch-Manager aktualisiert (v2.7.3)</body></html>","Auto-Patch HTML",token);
  await putFile("tools/js/patch-manager.js","// Patch-Manager JS v2.7.3","Auto-Patch JS",token);
  log("âœ… Patch-Manager v2.7.3 installiert & bestÃ¤tigt.");
  alert("Fertig âœ… Patch-Manager v2.7.3 wurde installiert.");
 }catch(e){
  log("ðŸŸ¥ Fehler: "+e.message);
  alert("Fehler beim Deploy: "+e.message);
 }finally{
  $("#go").disabled=false;$("#token").disabled=false;
 }
};

// URL-Token Ãœbernahme
$("#btnLoad").onclick=()=>{const t=new URLSearchParams(location.search).get("token");if(t)$("#token").value=t;log("ðŸ”‘ Token Ã¼bernommen.");};
</script>
</body>
</html>
<!-- rebuild v2.7.4 -->
