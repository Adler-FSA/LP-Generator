<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>üì¨ FSA Poststelle ¬∑ Mega-Patch-Deploy v2.6.0</title>
<style>
body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
background:#0b0f14;color:#e5e7eb;margin:0;padding:40px;text-align:center;}
h1{color:#38bdf8;margin-bottom:10px;}
.panel{max-width:800px;margin:0 auto;padding:24px;
background:#0f172a;border-radius:12px;box-shadow:0 4px 30px rgba(0,0,0,.4);}
input{padding:10px 14px;border-radius:8px;border:none;margin:8px 0;width:60%;
text-align:center;font-size:1rem;}
.btn{display:inline-block;padding:12px 24px;border-radius:8px;
background:#2563eb;color:#fff;font-weight:600;cursor:pointer;text-decoration:none;
margin:8px 4px;}
.btn:hover{background:#1d4ed8;}
.log{background:#111827;padding:16px;border-radius:8px;margin-top:24px;
font-size:.9rem;white-space:pre-wrap;overflow:auto;height:200px;text-align:left;}
.ready{color:#10b981;font-weight:600;margin-top:10px;}
</style>
</head>
<body>

<h1>üì¨ FSA Poststelle ¬∑ Mega-Patch-Deploy v2.6.0</h1>
<div class="panel">
<p>Dieser Lauf installiert / aktualisiert den <b>Patch-Manager v2.6.0</b> (Werkstatt-Erweiterung)
und legt ihn unter <code>/tools/patch-manager.html</code> ab.<br>
Danach kannst du ihn direkt √∂ffnen und weitere Patches ausf√ºhren.</p>

<input id="token" type="password" placeholder="Token eingeben ‚Ä¶" />
<button id="go" class="btn">üöÄ Mega-Patch starten</button>

<div class="ready" id="status">Bereit.</div>
<div class="log" id="log">Log gestartet ‚Ä¶</div>

<p style="font-size:.8rem;color:#94a3b8;margin-top:16px;">
Hinweis: Der Token wird <em>nicht gespeichert</em> ‚Äì nur f√ºr diesen Deploy-Lauf verwendet.
</p>
</div>

<script>
(async()=>{
  const logEl=document.getElementById("log");
  const statusEl=document.getElementById("status");
  const btn=document.getElementById("go");
  const input=document.getElementById("token");

  function log(msg){logEl.textContent+="\n"+msg;logEl.scrollTop=logEl.scrollHeight;}
  log("üì° FSA Poststelle initialisiert ‚Ä¶");

  const OWNER="Adler-FSA", REPO="Lp-Generator", BRANCH="main";
  const API=`https://api.github.com/repos/${OWNER}/${REPO}/contents/`;

  async function putFile(path,content,msg,token){
    const res1=await fetch(API+path+"?ref="+BRANCH,{headers:{Authorization:"token "+token}});
    const j1=await res1.json();const sha=j1.sha||null;
    const body={
      message:msg,
      content:btoa(unescape(encodeURIComponent(content))),
      branch:BRANCH
    };
    if(sha)body.sha=sha;
    const res2=await fetch(API+path,{
      method:"PUT",
      headers:{
        Authorization:"token "+token,
        "Content-Type":"application/json"
      },
      body:JSON.stringify(body)
    });
    return await res2.json();
  }

  const PATCH_HTML = `<!doctype html><html lang="de"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>FSA Patch-Manager v2.6.0</title></head><body style="font-family:system-ui;background:#0b0f14;color:#e5e7eb;padding:40px;"><h1>üß† FSA Patch-Manager v2.6.0</h1><p>Manager installiert ‚Äì bereit f√ºr Werkstatt-Module.</p><script src="js/patch-manager.js"></script></body></html>`;

  const PATCH_JS = `// Patch-Manager v2.6.0 (JS) ‚Äì bereit f√ºr Deploys\nconsole.log("Patch-Manager v2.6.0 aktiv");`;

  btn.onclick=async()=>{
    const token=(input.value||"").trim();
    if(!token){alert("Bitte g√ºltigen Token eingeben.");return;}
    statusEl.textContent="‚è≥ Starte Deploy ‚Ä¶";
    log("üöÄ Starte Mega-Patch-Deploy v2.6.0 ‚Ä¶");

    try{
      await putFile("tools/patch-manager.html",PATCH_HTML,"Add Patch-Manager v2.6.0 (HTML)",token);
      log("‚úÖ HTML installiert: /tools/patch-manager.html");
      await putFile("tools/js/patch-manager.js",PATCH_JS,"Add Patch-Manager v2.6.0 (JS)",token);
      log("‚úÖ JS installiert: /tools/js/patch-manager.js");
      statusEl.textContent="‚úÖ Deploy abgeschlossen";
      alert("Fertig ‚úÖ Patch-Manager v2.6.0 wurde installiert.");
    }catch(e){
      log("‚ùå Fehler: "+e.message);
      statusEl.textContent="‚ùå Fehler beim Deploy";
      alert("Fehler beim Deploy: "+e.message);
    }
  };
})();
</script>

</body>
</html>
