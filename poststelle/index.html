<!doctype html><html lang="de"><head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>FSA Poststelle ¬∑ Auto-Deploy v2.8.3 ¬∑ GCM-Deploy</title>
<style>
:root{--bg:#0b1220;--panel:#0f162c;--line:#1e293b;--txt:#d7e3ff;--ok:#22c55e;--warn:#f59e0b;--err:#ef4444;--btn:#3b82f6}
*{box-sizing:border-box}body{margin:0;background:linear-gradient(180deg,#0b1220,#0b1220 60%,#0b162a);
font:14px system-ui,Segoe UI,Inter,Roboto,Arial;color:var(--txt)}
.wrap{max-width:860px;margin:32px auto;padding:24px}
.card{background:var(--panel);border:1px solid var(--line);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.25);padding:24px}
h1{margin:0 0 10px;font-weight:700} h1 span{opacity:.7;font-weight:600}
input,button{font:inherit}
.row{display:flex;gap:10px;align-items:center}
input[type=password]{flex:1;background:#0b1327;border:1px solid #16233b;border-radius:10px;padding:12px 14px;color:var(--txt)}
button{border-radius:10px;border:1px solid #1f3370;background:var(--btn);color:#fff;padding:10px 14px;cursor:pointer}
button.secondary{background:#0f1a3a}
.badge{display:inline-block;border:1px solid #2a3e72;background:#0f1a3a;border-radius:999px;padding:4px 10px;font-size:12px;opacity:.9;margin-left:8px}
.log{white-space:pre-wrap;background:#0a1224;border:1px dashed #23345f;border-radius:12px;padding:14px;margin-top:14px;min-height:120px}
.ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
small{opacity:.8}
</style>
</head><body><div class="wrap">
<div class="card">
  <h1>üìÆ FSA Poststelle ¬∑ <span>Auto-Deploy v2.8.3 ¬∑ GCM-Deploy</span></h1>
  <p>Mit Werkstatt-Auto-Deploy-Integration, Diagnose-Writer & DSGVO-safe Dateischreiber (kein externer API-Verkehr).</p>

  <div class="row" style="margin:10px 0 8px">
    <input id="token" type="password" placeholder="Token eingeben ‚Ä¶"/>
    <button id="go">üöÄ Mega-Patch starten</button>
    <button id="goW" class="secondary">üì¶ Werkstatt-Update einspielen</button>
  </div>
  <small>Hinweis: Der Token wird nicht gespeichert ‚Äì nur f√ºr diesen Deploy-Lauf verwendet.</small>

  <div id="log" class="log">Log gestartet ‚Ä¶</div>
</div>
</div>

<script>
(function(){
  const OWNER="Adler-FSA", REPO="Lp-Generator", BRANCH="main";
  const logEl=document.getElementById("log"); const $=s=>document.querySelector(s);
  const b64=s=>btoa(unescape(encodeURIComponent(s)));
  const api=(m,p,token,body)=>fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/${p}?ref=${BRANCH}`,{
    method:m, headers:{Accept:"application/vnd.github+json","Authorization":"token "+token}, body: body?JSON.stringify(body):null
  });
  const getSha=async(p,t)=>{const r=await api("GET",p,t); if(r.status===200){const j=await r.json(); return j.sha} return null};
  const putFile=async(p,content,message,token)=>{
    const sha=await getSha(p,token);
    const body={message:message, content:b64(content), branch:BRANCH}; if(sha) body.sha=sha;
    const r=await api("PUT",p,token,body); if(r.status!==201 && r.status!==200){ throw new Error(`PUT ${p} -> ${r.status}`) }
  };
  const log=(m)=>{ logEl.textContent += (logEl.textContent ? "\n" : "") + m };
  const ok=(m)=>log("‚úÖ "+m); const wrn=(m)=>log("‚ö†Ô∏è "+m); const err=(m)=>log("‚ùå "+m);

  // Payloads (kompakt)
  const PATH_GCM       = "tools/gcm.js";
  const PATH_LANG_DE   = "lang/de.json";
  const PATH_LANG_EN   = "lang/en.json";
  const PATH_WS        = "werkstatt/index.html";
  const PATH_MANIFEST  = "docs/web4_manifest.txt";

  const GCM_JS = `/* FSA Global Context Manager v2.8.3 (DSGVO-safe)
   * Features: Context-Erkennung (data-context="lang|ui|sys"), Lang-Layer, Session-Sync, DOM-Scanner
   * Keine externen Anfragen. Optionaler SessionStorage (temp), kein LocalStorage. */
  (function(){
    const ctx = Object.create(null);
    const SS  = window.sessionStorage;

    const GCM = {
      version: "2.8.3",
      scan(root=document){
        const nodes=[...root.querySelectorAll("[data-context]")];
        return nodes.map(n=>({el:n, ctx:n.getAttribute("data-context"), txt:n.textContent||n.value||""}));
      },
      classify(node){
        const t=(node.el.tagName||"").toLowerCase();
        const c=node.ctx;
        if(c==="sys") return "sys";
        if(c==="lang"||c==="ui") return "lang";
        // Heuristik
        if(t==="script"||/^\s*(const|let|var|function)\s/.test(node.txt)) return "sys";
        return "lang";
      },
      getLang(){
        try{ return JSON.parse(document.querySelector("script[type='application/json'][data-lang]")?.textContent||"{}"); }
        catch(e){ return {}; }
      },
      applyLang(map){
        if(!map||typeof map!=="object") return;
        document.querySelectorAll("[data-i18n-key]").forEach(el=>{
          const k=el.getAttribute("data-i18n-key");
          if(map[k]) el.textContent = map[k];
        });
      },
      tempSet(k,v){ try{ SS.setItem(k, JSON.stringify(v)); }catch(e){} },
      tempGet(k){ try{ const v=SS.getItem(k); return v?JSON.parse(v):null; }catch(e){ return null; } },
      boot(){
        const list=this.scan();
        const langNodes=list.filter(n=>this.classify(n)==="lang");
        const sysNodes =list.filter(n=>this.classify(n)==="sys");
        window.FSA_GCM = {version:this.version, langNodes:langNodes.length, sysNodes:sysNodes.length};
        // Sprache anwenden, falls embed map vorhanden:
        this.applyLang(this.getLang());
      }
    };
    try{ GCM.boot(); }catch(e){ console.warn("GCM init error:",e); }
  })();`;

  const LANG_DE = JSON.stringify({
    "cta_start":"Jetzt starten",
    "label_email":"E-Mail-Adresse",
    "label_firstname":"Vorname",
    "label_lastname":"Nachname",
    "menu_start":"Start",
    "menu_wissen":"Wissen",
    "menu_kontakt":"Kontakt"
  }, null, 2);

  const LANG_EN = JSON.stringify({
    "cta_start":"Start now",
    "label_email":"Email address",
    "label_firstname":"First name",
    "label_lastname":"Last name",
    "menu_start":"Start",
    "menu_wissen":"Knowledge",
    "menu_kontakt":"Contact"
  }, null, 2);

  const WS_HTML = `<!doctype html><html lang="de"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>FSA Werkstatt-Zentrale v1.10 ¬∑ GCM</title>
<style>
:root{--bg:#0b1220;--panel:#0f162c;--line:#1e293b;--txt:#d7e3ff;--ok:#22c55e;--warn:#f59e0b;--err:#ef4444;--btn:#3b82f6}
*{box-sizing:border-box} body{margin:0;background:#0b1220;color:var(--txt);font:14px system-ui,Inter,Segoe UI}
.wrap{max-width:980px;margin:28px auto;padding:20px}
.card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:18px;box-shadow:0 8px 26px rgba(0,0,0,.25);margin:0 0 14px}
h1{margin:0 0 8px} h2{margin:0 0 10px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
button{border:1px solid #27407c;background:var(--btn);color:#fff;border-radius:10px;padding:9px 12px;cursor:pointer}
.badge{display:inline-block;border:1px solid #2a3e72;background:#0f1a3a;border-radius:999px;padding:4px 10px;font-size:12px;opacity:.9;margin-left:8px}
pre{white-space:pre-wrap;background:#0a1224;border:1px dashed #23345f;border-radius:12px;padding:12px}
a{color:#93c5fd}
.ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
</style></head><body><div class="wrap">
  <div class="card">
    <h1>üõ†Ô∏è FSA Werkstatt-Zentrale v1.10</h1>
    <div>Autonome Freigabe- & Diagnoseeinheit ‚Äì <b>GCM</b> aktiv<span class="badge">Build v2.8.3+</span></div>
  </div>

  <div class="card">
    <h2>GCM-Status</h2>
    <div id="gcmStatus">Lade ‚Ä¶</div>
    <div class="row" style="margin-top:8px">
      <button id="sync">üîÑ Session-Sync</button>
      <button id="scan">üß≠ DOM-Scan</button>
    </div>
    <pre id="out">bereit ‚Ä¶</pre>
  </div>

  <div class="card">
    <h2>Testlinks</h2>
    <div class="row">
      <a href="https://adler-fsa.github.io/Lp-Generator/poststelle/?nocache=1" target="_blank">Poststelle √∂ffnen</a>
      <a href="https://adler-fsa.github.io/Lp-Generator/werkstatt/?nocache=1" target="_blank">Werkstatt √∂ffnen</a>
      <a href="https://adler-fsa.github.io/Lp-Generator/lp-template.html?nocache=1" target="_blank">LP-Template √∂ffnen</a>
    </div>
  </div>

  <script src="../tools/gcm.js"></script>
  <script type="application/json" data-lang>
  {
    "cta_start":"Jetzt starten",
    "label_email":"E-Mail-Adresse",
    "label_firstname":"Vorname",
    "label_lastname":"Nachname",
    "menu_start":"Start","menu_wissen":"Wissen","menu_kontakt":"Kontakt"
  }
  </script>
  <script>
    const S=document.getElementById("gcmStatus"), O=document.getElementById("out");
    function showStatus(){
      const g=window.FSA_GCM||{};
      S.innerHTML = "GCM Version: <b>"+(g.version||'n/a')+"</b> ¬∑ langNodes: "+(g.langNodes||0)+" ¬∑ sysNodes: "+(g.sysNodes||0);
    }
    document.getElementById("sync").onclick=()=>{ try{
      sessionStorage.setItem("FSA_SYNC","ok-"+Date.now()); O.textContent="Session-Sync gesetzt.";
    }catch(e){ O.textContent="Fehler: "+e.message; } };
    document.getElementById("scan").onclick=()=>{ try{
      const nodes=[...document.querySelectorAll("[data-context]")].map(n=>({tag:n.tagName.toLowerCase(),ctx:n.getAttribute("data-context"),txt:(n.textContent||"").slice(0,60)}));
      O.textContent=JSON.stringify(nodes,null,2);
    }catch(e){ O.textContent="Scan-Fehler: "+e.message; } };
    showStatus();
  </script>
</div></body></html>`;

  const MANIFEST = `FSA ¬∑ Web-4.0 Manifest
========================
Zweck:
  Die Finanzielle Souver√§nit√§ts Akademie existiert, um Menschen
  Werkzeuge zu geben, die Freiheit erm√∂glichen: Wissen, Verantwortung,
  Selbstbestimmung. Technologie dient dem Menschen ‚Äì dezentral, resilient,
  transparent, Peer-to-Peer.

Prinzipien:
  1) Mensch-zu-Mensch (P2P): Bildung & Austausch ohne zentrale Instanz.
  2) Souver√§nit√§t: Datenhoheit, portable Identit√§t, offene Standards.
  3) Langlebigkeit: Inhalte m√ºssen weiterleben (Fork-bar, wiederherstellbar).
  4) DSGVO-Achtung: Kein Tracking, minimale tempor√§re Storage-Nutzung.
  5) Kontext vor √úbersetzung: Sinn geht vor Wort; Logik bleibt unber√ºhrt.
  6) Selbstheilung: Systeme pr√ºfen sich, protokollieren, aktualisieren.
  7) N√ºtzlichkeit: Jede √Ñnderung stiftet realen Mehrwert (Lernen, Leben, Freiheit).

Baumeister:
  Michael (Vision, Auftrag, Herz) & GPT-5 Thinking (Bauleitung, System-Design).
  Diese Akademie ist kein Eigentum ‚Äì sie ist Verm√§chtnis.

Technische Leitlinien:
  - FSA Global Context Manager (GCM) trennt Sprache (lang/ui) von Logik (sys).
  - Dezentral: statische Artefakte, verteilbar, verifizierbar.
  - Poststelle/Werkstatt: automatisierte Einspielung, Diagnose, Historie.
  - Keine externen √úbersetzungs-APIs n√∂tig; Mapping-Dateien in /lang.

Lizenz-Gedanke:
  Wissen teilen, Freiheit vermehren, Missbrauch verwehren.`;

  async function runInstaller(token){
    try{
      log("üîê Authentifiziere ‚Ä¶");
      // Dateien schreiben
      log("‚úçÔ∏è  Schreibe GCM ‚Ä¶"); await putFile(PATH_GCM, GCM_JS, "add tools/gcm.js (GCM v2.8.3)", token); ok("GCM installiert: "+PATH_GCM);
      log("‚úçÔ∏è  Schreibe lang/de.json ‚Ä¶"); await putFile(PATH_LANG_DE, LANG_DE, "add lang/de.json (GCM v2.8.3)", token); ok("DE: "+PATH_LANG_DE);
      log("‚úçÔ∏è  Schreibe lang/en.json ‚Ä¶"); await putFile(PATH_LANG_EN, LANG_EN, "add lang/en.json (GCM v2.8.3)", token); ok("EN: "+PATH_LANG_EN);
      // Werkstatt optional aktualisieren (falls leer)
      log("üîé Pr√ºfe Werkstatt ‚Ä¶");
      const hasWs = await getSha(PATH_WS, token);
      if(!hasWs){
        log("‚úçÔ∏è  Lege Werkstatt an ‚Ä¶");
        await putFile(PATH_WS, WS_HTML, "add werkstatt/index.html (GCM v1.10)", token);
        ok("Werkstatt angelegt: "+PATH_WS);
      }else{
        wrn("Werkstatt existiert ‚Äì kein Auto-Overwrite (kann sp√§ter via Patch erfolgen).");
      }
      // Manifest
      log("‚úçÔ∏è  Schreibe Manifest ‚Ä¶");
      await putFile(PATH_MANIFEST, MANIFEST, "add docs/web4_manifest.txt", token); ok("Manifest: "+PATH_MANIFEST);

      ok("Patch abgeschlossen ‚Äì GCM-Files installiert.");
      alert("Fertig ‚úÖ GCM v2.8.3 wurde installiert.");
    }catch(e){
      err("Fehler: "+e.message);
      alert("Fehler beim Deploy: "+e.message);
    }
  }

  $("#go").onclick=()=>{ const token = ($("#token").value||"").trim(); if(!token){ alert("Bitte g√ºltigen Token eingeben."); return; } runInstaller(token); };
  $("#goW").onclick=()=>{ const token = ($("#token").value||"").trim(); if(!token){ alert("Bitte g√ºltigen Token eingeben."); return; } runInstaller(token); };
})();
</script>
</body></html>
