<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LP-Generator v2.4.4b SAFE+UX</title>
<style>
  /* === Dashboard Grundlayout === */
  #ws-dashboard {
    position: fixed;
    bottom: 12px;
    right: 12px;
    background: linear-gradient(135deg, #0f172a, #1e293b);
    color: #e2e8f0;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    padding: 12px 16px;
    box-shadow: 0 8px 28px rgba(0,0,0,0.35);
    font-family: system-ui, Segoe UI, Roboto, sans-serif;
    font-size: 13.5px;
    line-height: 1.4;
    z-index: 9999;
    transition: all .3s ease;
  }

  #ws-dashboard h3 {
    margin: 0 0 6px 0;
    font-size: 14px;
    color: #38bdf8;
  }

  #ws-dashboard button {
    background: #38bdf8;
    color: #0f172a;
    border: none;
    border-radius: 6px;
    padding: 6px 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all .25s ease;
    margin-top: 6px;
  }

  #ws-dashboard button:hover {
    background: #0ea5e9;
    color: #fff;
    transform: scale(1.05);
  }

  #ws-dashboard small {
    display: block;
    margin-top: 6px;
    color: #94a3b8;
    font-size: 12px;
  }

  #ws-dashboard b { color: #22d3ee; }

  @keyframes dots {
    0% {content: ".";}
    33% {content: "..";}
    66% {content: "...";}
    100% {content: ".";}
  }

  #ws-state::after {
    animation: dots 1.5s steps(3, end) infinite;
  }

  .status-ok   { color:#22c55e !important; }  /* Gr√ºn: Aktiv */
  .status-warn { color:#f59e0b !important; }  /* Gelb: Warten */
  .status-err  { color:#ef4444 !important; }  /* Rot: Fehler */

  /* === Aufklapp-Men√º (Funktions√ºbersicht) === */
  #ws-info {
    display: none;
    margin-top: 8px;
    padding: 8px 10px;
    border-top: 1px solid rgba(255,255,255,0.1);
    font-size: 12.5px;
    color: #cbd5e1;
    background: rgba(15,23,42,0.7);
    border-radius: 6px;
    line-height: 1.5;
  }
  #ws-info ul { margin: 6px 0 0 14px; padding: 0; }
  #ws-info li { margin-bottom: 4px; }

  #toggle-info {
    background: none;
    border: none;
    color: #38bdf8;
    font-size: 12.5px;
    cursor: pointer;
    text-decoration: underline;
    margin-top: 4px;
  }
  #toggle-info:hover { color:#0ea5e9; }
</style>
</head>

<body style="background:#0b0f14; color:#e5e7eb; font-family:system-ui, sans-serif;">

  <!-- üß© Dashboard -->
  <div id="ws-dashboard">
    <h3>üß∞ Werkstatt Dashboard <small>v2.4.4b SAFE+UX</small></h3>
    <div>Module: <b id="ws-modules">ReBind, UI, Check, Console</b></div>
    <div>Status: <b id="ws-state" class="status-warn">Initialisiere...</b></div>
    <button id="ws-restart">Neu-Scan</button>
    <button id="toggle-info">‚ñº Funktions√ºbersicht</button>

    <!-- Aufklappfeld -->
    <div id="ws-info">
      <b>Funktions√ºbersicht:</b>
      <ul>
        <li>üß© <b>Dashboard</b> ‚Äì zeigt Systemstatus & aktive Module</li>
        <li>‚öôÔ∏è <b>Auto-Check</b> ‚Äì pr√ºft GitHub-Pages-Verf√ºgbarkeit</li>
        <li>üü¢ <b>Statusfarben</b> ‚Äì Gr√ºn = aktiv, Gelb = pr√ºfen, Rot = Fehler</li>
        <li>üîÅ <b>Neu-Scan</b> ‚Äì startet Pr√ºfung & ReBind-Event neu</li>
        <li>üß± <b>SAFE-Modus</b> ‚Äì sch√ºtzt gegen doppelte Instanzen</li>
      </ul>
    </div>
  </div>

<script>
(() => {
  const state = document.getElementById('ws-state');
  const modules = document.getElementById('ws-modules');
  const restart = document.getElementById('ws-restart');
  const infoBtn = document.getElementById('toggle-info');
  const infoBox = document.getElementById('ws-info');

  // Toggle Funktions√ºbersicht
  infoBtn.onclick = () => {
    const open = infoBox.style.display === 'block';
    infoBox.style.display = open ? 'none' : 'block';
    infoBtn.textContent = open ? '‚ñº Funktions√ºbersicht' : '‚ñ≤ Schlie√üen';
  };

  // Initialzustand
  state.textContent = 'Scan l√§uft...';
  state.className = 'status-warn';
  modules.textContent = 'Module: ReBind, UI, Check, Console';

  // Ereignisse abfangen
  window.addEventListener('WerkstattReady', () => {
    state.textContent = 'Aktiv';
    state.className = 'status-ok';
  });

  window.addEventListener('WerkstattError', () => {
    state.textContent = 'Fehler';
    state.className = 'status-err';
  });

  // Manuell neu starten
  restart.onclick = () => {
    state.textContent = 'Neu-Scan l√§uft...';
    state.className = 'status-warn';
    console.clear();
    document.dispatchEvent(new CustomEvent('WerkstattRebindInit'));
    setTimeout(checkGithubPages, 1500);
  };

  // Auto-Check auf GitHub-Pages Erreichbarkeit
  async function checkGithubPages() {
    const dashboardStatus = document.getElementById('ws-state');
    try {
      const resp = await fetch('https://adler-fsa.github.io/', { cache: 'no-store' });
      if (!resp.ok) throw new Error('Seite offline oder im Neuaufbau');

      const html = await resp.text();
      if (html.includes('404') || html.includes('not found')) {
        dashboardStatus.textContent = '‚ö†Ô∏è GitHub Pages im Neuaufbau ‚Äì bitte 2‚Äì3 Minuten warten';
        dashboardStatus.className = 'status-warn';
        modules.textContent = 'Module: ReBind, UI, Check, Console (Standby)';
      } else {
        console.log('‚úÖ GitHub Pages online und aktiv.');
        document.dispatchEvent(new CustomEvent('WerkstattReady'));
      }
    } catch (err) {
      dashboardStatus.textContent = 'üö´ GitHub Pages aktuell nicht erreichbar';
      dashboardStatus.className = 'status-err';
      modules.textContent = 'Module: Offline ‚Äì Verbindung pr√ºfen';
      console.warn('Werkstatt: GitHub Pages Error ‚Üí', err.message);
    }
  }

  // Erststart beim Laden
  checkGithubPages();
})();
</script>
</body>
</html>
