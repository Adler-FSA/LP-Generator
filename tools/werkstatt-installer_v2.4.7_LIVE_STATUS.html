<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ü¶Ö Adler-FSA Werkstatt-Installer v2.4.7 LIVE-STATUS</title>
<style>
body {
  background:#0b0f14;
  color:#e2e8f0;
  font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;
  text-align:center;
  padding:40px 12px;
}
h1 {color:#38bdf8;font-size:1.6rem;margin-bottom:12px}
p {color:#94a3b8;margin-top:0;margin-bottom:20px}
input {
  background:#1e293b;border:1px solid #334155;color:#e2e8f0;
  padding:10px 14px;border-radius:8px;width:280px;font-size:.95rem;margin-top:10px;
}
button {
  margin-top:20px;background:#06b6d4;border:none;color:#fff;
  font-weight:600;padding:10px 20px;border-radius:8px;
  cursor:pointer;transition:.25s;
}
button:hover {background:#0891b2}
pre {
  text-align:left;background:#1e293b;border-radius:8px;
  padding:12px;max-width:480px;margin:20px auto 0;
  overflow:auto;font-size:.85rem;line-height:1.4;color:#a5b4fc;
}
.ok{color:#10b981}
.err{color:#f87171}
.info{color:#facc15}
</style>
</head>
<body>
<h1>ü¶Ö Adler-FSA Werkstatt-Installer v2.4.7 LIVE-STATUS</h1>
<p>Installiert automatisch die neue Werkstatt <b>v2.4.7</b>, √ºberwacht den Deploy-Status und √∂ffnet die neue Seite nach Fertigstellung.</p>

<input id="token" type="password" placeholder="üîë GitHub Token (fine-grained oder classic)">
<br>
<button onclick="install()">üöÄ Werkstatt installieren</button>

<pre id="log"></pre>

<script>
async function log(msg, cls=''){const el=document.getElementById('log');
  el.innerHTML+=`<span class="${cls}">${msg}</span>\n`;el.scrollTop=el.scrollHeight;}

async function install(){
  const token=document.getElementById('token').value.trim();
  if(!token){alert('Bitte Token eingeben');return;}

  const repo="Adler-FSA/Lp-Generator";
  const files=[
    {
      path:"tools/Adler-FSA_Werkstatt_v2.4.7_LIVE_STATUS.html",
      message:"Add Adler-FSA Werkstatt v2.4.7 LIVE_STATUS",
      content:btoa(`<!doctype html><html lang='de'><meta charset='utf-8'><title>ü¶Ö Adler-FSA Werkstatt v2.4.7</title><body style='font-family:system-ui;background:#0b0f14;color:#eaf2ff;text-align:center;padding:20vh 10px'><h1>ü¶Ö Adler-FSA Werkstatt v2.4.7</h1><p>Erfolgreich installiert und ver√∂ffentlicht.<br>Dashboard & Live-Module werden nach Patches aktiviert.</p></body></html>`)
    },
    {path:"tools/js/monitor.js",message:"Update monitor.js",content:btoa("console.log('üõ†Ô∏è monitor.js v2.4.7 ready');")},
    {path:"tools/js/glow.js",message:"Update glow.js",content:btoa("console.log('‚ú® glow.js v2.4.7 ready');")},
    {path:"tools/js/lang.js",message:"Update lang.js",content:btoa("console.log('üåç lang.js v2.4.7 ready');")},
    {path:"tools/js/patch-manager.js",message:"Update patch-manager.js",content:btoa("console.log('ü©π patch-manager.js v2.4.7 ready');")}
  ];

  await log("üîó Verbinde mit GitHub ‚Ä¶","info");

  for(const f of files){
    try{
      const check=await fetch(`https://api.github.com/repos/${repo}/contents/${f.path}`,{
        headers:{"Authorization":`token ${token}`}
      });
      const exists=check.status===200?await check.json():null;
      const body={message:f.message,content:f.content};
      if(exists)body.sha=exists.sha;

      const put=await fetch(`https://api.github.com/repos/${repo}/contents/${f.path}`,{
        method:"PUT",
        headers:{"Authorization":`token ${token}`,"Content-Type":"application/json"},
        body:JSON.stringify(body)
      });

      if(put.ok)await log(`‚úÖ ${f.path}`,"ok");
      else await log(`‚ö†Ô∏è ${f.path} (${put.status})`,"err");
    }catch(e){await log(`‚ùå Fehler bei ${f.path}: ${e}`,"err");}
  }

  await log("üîÅ Starte GitHub Pages Auto-Deploy ‚Ä¶","info");
  const deploy=await fetch(`https://api.github.com/repos/${repo}/pages/builds`,{
    method:"POST",
    headers:{"Authorization":`token ${token}`}
  });

  if(deploy.ok)await log("üü¢ Deploy-Trigger erfolgreich.","ok");
  else await log(`‚ö†Ô∏è Deploy-Trigger fehlgeschlagen (${deploy.status}).`,"err");

  await log("‚è±Ô∏è Warte auf Build (max. 3 Min) ‚Ä¶","info");
  let built=false;
  for(let i=0;i<18;i++){
    await new Promise(r=>setTimeout(r,10000));
    const s=await fetch(`https://api.github.com/repos/${repo}/pages/builds/latest`,{
      headers:{"Authorization":`token ${token}`}
    });
    if(s.ok){
      const j=await s.json();
      if(j.status==="built"){built=true;break;}
      if(j.status==="errored"){await log("‚ùå Build-Fehler. Siehe Actions ‚Ä∫ Pages.","err");break;}
      await log(`‚Ä¶ Status: ${j.status}`,"info");
    }
  }

  if(built){
    await log("‚úÖ Build abgeschlossen! √ñffne neue Werkstatt ‚Ä¶","ok");
    await log("üåê https://adler-fsa.github.io/Lp-Generator/tools/Adler-FSA_Werkstatt_v2.4.7_LIVE_STATUS.html","info");
    setTimeout(()=>{window.location.href="https://adler-fsa.github.io/Lp-Generator/tools/Adler-FSA_Werkstatt_v2.4.7_LIVE_STATUS.html";},2000);
  }else{
    await log("‚ö†Ô∏è Kein Abschluss innerhalb des Zeitlimits.","warn");
  }
}
</script>
</body>
</html>
